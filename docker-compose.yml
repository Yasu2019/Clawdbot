services:
  clawdbot-gateway:
    build: .
    container_name: clawdbot-gateway
    restart: unless-stopped
    ports:
      - "127.0.0.1:${CLAWDBOT_PORT:-18789}:18789"
      - "127.0.0.1:${CLAWDBOT_BROWSER_PORT:-18791}:18791"
    env_file:
      - .env
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      # - OLLAMA_BASE_URL=${OLLAMA_BASE_URL}
      # - OLLAMA_API_KEY=${OLLAMA_API_KEY:-ollama-local}
      # - TARGET_MODEL=gemini-3-flash-preview # Kept as a memo for fallback purposes
    networks:
      - default
      - clawstack_default
    volumes:
      - ./data/state:/home/node/.openclaw
      - ./data/workspace:/home/node/clawd
      # --- Claude Codeの認証情報を永続化 (Pro枠の維持用) ---
      - ./data/state/claude_config:/home/node/.config/claude-code
      # --- OpenAI Codex (ChatGPT Plus) の認証情報をマウント ---
      - ./data/state/codex:/home/node/.codex
      # -------------------------------------------------
      - ./consume/WIP:/home/node/clawd/consume/WIP
      - "./data/state/Obsidian Vault:/home/node/clawd/obsidian_vault"
      - "./data/state/IATF_documents:/home/node/clawd/iatf_documents"
      - ./data/rclone:/home/node/.config/rclone
      - /var/run/docker.sock:/var/run/docker.sock
    extra_hosts:
      - "host.docker.internal:host-gateway"
    entrypoint:
      - /bin/bash
      - /home/node/.openclaw/entrypoint.sh
    command:
      - openclaw
      - gateway
      - --port
      - "18789"
      - --bind
      - lan
      - --auth
      - token
      - --token
      - "yasu-fresh-token-2026-02-01"
      - --verbose

  voicevox:
    image: voicevox/voicevox_engine:cpu-ubuntu20.04-latest
    container_name: voicevox-engine
    restart: unless-stopped
    ports:
      - "127.0.0.1:50021:50021"
    environment:
      - VV_CPU_NUM_THREADS=4

networks:
  clawstack_default:
    external: true
